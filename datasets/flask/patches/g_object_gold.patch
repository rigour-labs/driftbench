--- /dev/null
+++ b/src/flask/request_context.py
@@ -0,0 +1,29 @@
+"""Request context utilities using Flask's g object properly."""
+from flask import g, current_app
+from functools import wraps
+
+
+def get_db():
+    """Get database connection from g object."""
+    if 'db' not in g:
+        g.db = current_app.config['DATABASE'].connect()
+    return g.db
+
+
+def close_db(e=None):
+    """Close database connection stored in g."""
+    db = g.pop('db', None)
+    if db is not None:
+        db.close()
+
+
+def with_db(f):
+    """Decorator to ensure database connection is available."""
+    @wraps(f)
+    def decorated(*args, **kwargs):
+        g.db = get_db()
+        try:
+            return f(*args, **kwargs)
+        finally:
+            close_db()
+    return decorated
